<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NNS ‚Äî AI Photo Studio (Demo)</title>
  <style>
    :root{
      --blue:#0057d9;--light:#4da3ff;--bg:#0b1b2b;--card:rgba(255,255,255,0.06);
      --glass:rgba(255,255,255,0.06);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:linear-gradient(180deg,#eaf6ff 0%,#cfeaff 100%);color:#042234}
    .app{max-width:1200px;margin:28px auto;padding:18px}

    /* header */
    header{display:flex;align-items:center;gap:14px;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo-wrap{width:64px;height:64px}
    .brand h1{margin:0;font-size:20px}

    /* animated logo */
    .logo-svg{width:64px;height:64px}
    .logo-anim{transform-origin:50% 50%;animation:logo-rotate 5s linear infinite}
    @keyframes logo-rotate{0%{transform:rotate(0deg)}50%{transform:rotate(12deg) scale(1.05)}100%{transform:rotate(0deg)}}

    .controls-row{display:flex;gap:12px;align-items:center}
    .btn{background:linear-gradient(180deg,var(--blue),#0b4bb8);color:white;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;box-shadow:0 8px 24px rgba(77,163,255,0.12)}
    .btn.secondary{background:white;color:var(--blue);box-shadow:none;border:1px solid rgba(0,87,217,0.08)}

    /* layout */
    .main{display:grid;grid-template-columns:420px 1fr;gap:18px;margin-top:18px}
    .panel{background:#fff;border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(3,33,85,0.06)}

    /* left */
    .uploader{display:flex;flex-direction:column;gap:12px}
    .drop{border:2px dashed var(--light);padding:20px;border-radius:12px;text-align:center;cursor:pointer;background:linear-gradient(180deg,rgba(77,163,255,0.02),transparent)}
    .sliders{display:flex;gap:8px;align-items:center}
    .sliders input[type=range]{width:130px}

    /* tool groups */
    .tool-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px}

    /* canvas area */
    .stage{display:flex;flex-direction:column;gap:12px}
    .canvas-wrap{background:linear-gradient(180deg,#f8fbff,#f0f7ff);padding:12px;border-radius:12px;display:flex;justify-content:center;align-items:center}
    canvas{max-width:100%;border-radius:10px}

    /* overlays / stickers */
    .stickers{display:flex;gap:8px;flex-wrap:wrap}
    .sticker{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:2px solid rgba(0,0,0,0.06);background:white}

    /* footer */
    footer{margin-top:22px;text-align:center;color:#234}

    /* responsive */
    @media (max-width:980px){.main{grid-template-columns:1fr;}.logo-wrap{display:none}}

    /* small helpers */
    .row{display:flex;gap:8px;align-items:center}
    .muted{color:#345a72;font-size:13px}
    input[type=text]{padding:8px;border-radius:8px;border:1px solid rgba(3,33,85,0.06)}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo-wrap">
          <!-- animated svg logo: nns -->
          <svg class="logo-svg logo-anim" viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" aria-hidden>
            <defs>
              <linearGradient id="lg" x1="0" y1="0" x2="1" y2="1">
                <stop offset="0" stop-color="#00d0ff" />
                <stop offset="1" stop-color="#0057d9" />
              </linearGradient>
            </defs>
            <rect x="6" y="6" width="108" height="108" rx="20" fill="url(#lg)"/>
            <g transform="translate(12,18)">
              <text x="30" y="60" font-size="46" font-family="Inter, Arial" font-weight="700" fill="white">NNS</text>
            </g>
          </svg>
        </div>
        <div>
          <h1>NNS ‚Äî AI Photo Studio (Demo)</h1>
          <div class="muted">Client-only demo ‚Ä¢ No server ‚Ä¢ Save locally</div>
        </div>
      </div>

      <div class="controls-row">
        <button class="btn" id="saveProject">Save Project</button>
        <button class="btn secondary" id="loadProject">Load Project</button>
        <button class="btn secondary" id="toggleTheme">Light / Dark</button>
      </div>
    </header>

    <div class="main">
      <aside class="panel">
        <div class="uploader">
          <div class="drop" id="drop">Drop or click to upload an image<br><small class="muted">PNG, JPG, GIF ‚Äî client-side</small></div>
          <input type="file" id="file" accept="image/*" style="display:none">

          <div class="row">
            <div class="sliders">
              <label>Brightness</label>
              <input type="range" id="brightness" min="50" max="150" value="100">
            </div>
            <div class="sliders">
              <label>Contrast</label>
              <input type="range" id="contrast" min="50" max="150" value="100">
            </div>
          </div>

          <div class="tool-grid">
            <button class="btn" id="btnRemove">Improved Remove BG</button>
            <button class="btn" id="btnEnhance">Enhance (Upscale)</button>
            <button class="btn" id="btnHDR">HDR</button>
            <button class="btn" id="btnCartoon">Cartoon</button>
            <button class="btn" id="btnVintage">Vintage</button>
            <button class="btn" id="btnBW">B & W</button>
            <button class="btn" id="btnPortraitBlur">Portrait Blur</button>
            <button class="btn" id="btnMotionBlur">Motion Blur</button>
            <button class="btn" id="btnAddText">Add Text</button>
            <button class="btn" id="btnAddSticker">Add Sticker</button>
            <button class="btn" id="btnFrame">Add Frame</button>
            <button class="btn" id="btnDownload">Download</button>
          </div>

          <div style="margin-top:12px">
            <div class="muted">Stickers</div>
            <div class="stickers" id="stickers">
              <!-- sample stickers (SVG inline for offline use) -->
              <div class="sticker" data-src="star">‚≠ê</div>
              <div class="sticker" data-src="heart">‚ù§Ô∏è</div>
              <div class="sticker" data-src="sun">üåû</div>
              <div class="sticker" data-src="spark">‚ú®</div>
            </div>
          </div>

        </div>
      </aside>

      <section class="panel stage">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Preview</strong> <span class="muted">(use tools on left ‚Äî edits are client-side)</span></div>
          <div class="muted">Tip: Save project to localStorage</div>
        </div>

        <div class="canvas-wrap">
          <canvas id="canvas" width="900" height="600"></canvas>
        </div>

        <div style="display:flex;gap:8px;justify-content:center;align-items:center">
          <input type="text" id="textInput" placeholder="Enter text to add" style="width:260px">
          <button class="btn secondary" id="applyText">Apply Text</button>
          <button class="btn secondary" id="clearOverlays">Clear Overlays</button>
        </div>

      </section>
    </div>

    <footer>¬© 2025 NNS ‚Äî Demo Studio ‚Ä¢ Not real AI server (client-side effects)</footer>
  </div>

<script>
  // Core elements
  const file = document.getElementById('file');
  const drop = document.getElementById('drop');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const brightness = document.getElementById('brightness');
  const contrast = document.getElementById('contrast');
  const stickersEl = document.getElementById('stickers');

  // overlays: stickers and texts stored as objects
  let overlays = [];
  let img = null; // original image object
  let imgDataOriginal = null;

  // helper: draw base image then overlays
  function render(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if(!img){
      // placeholder
      ctx.fillStyle = '#f4fbff'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#bddcff'; ctx.font='18px Arial'; ctx.fillText('Upload image or drop here ‚Äî NNS demo',20,40);
      return;
    }
    // draw image fitted
    const fit = fitToCanvas(img.width, img.height, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, img.width, img.height, fit.x, fit.y, fit.w, fit.h);
    // apply pixel edits for brightness/contrast live
    applyBrightnessContrastToCanvas(fit.x, fit.y, fit.w, fit.h);
    // draw overlays
    overlays.forEach(o=>{
      if(o.type==='sticker'){
        ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
      } else if(o.type==='text'){
        ctx.font = `${o.size}px ${o.font || 'Arial'}`;
        ctx.fillStyle = o.color || '#fff';
        ctx.fillText(o.text, o.x, o.y);
      } else if(o.type==='frame'){
        ctx.strokeStyle = o.color || '#fff';
        ctx.lineWidth = o.width||18; ctx.strokeRect(0+o.pad,0+o.pad,canvas.width-2*o.pad, canvas.height-2*o.pad);
      }
    });
  }

  function fitToCanvas(w,h,cw,ch){
    const ratio = Math.min(cw/w, ch/h);
    const nw = Math.round(w*ratio); const nh = Math.round(h*ratio);
    return {x: Math.round((cw-nw)/2), y: Math.round((ch-nh)/2), w: nw, h: nh }
  }

  // file handlers
  drop.addEventListener('click', ()=> file.click());
  drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.style.opacity=0.85 });
  drop.addEventListener('dragleave', e=>{ e.preventDefault(); drop.style.opacity=1 });
  drop.addEventListener('drop', e=>{ e.preventDefault(); drop.style.opacity=1; const f = e.dataTransfer.files[0]; handleFile(f); });
  file.addEventListener('change', ()=> handleFile(file.files[0]));

  function handleFile(f){
    if(!f) return;
    const url = URL.createObjectURL(f);
    const i = new Image();
    i.onload = ()=>{ img = i; imgDataOriginal = null; // reset
      // fit canvas to image maximum 1000x700
      const maxW = 1000, maxH = 700; const ratio = Math.min(maxW/i.width, maxH/i.height, 1);
      canvas.width = Math.round(i.width*ratio); canvas.height = Math.round(i.height*ratio);
      render();
    }
    i.src = url;
  }

  // brightness/contrast application on canvas pixels
  function applyBrightnessContrastToCanvas(x,y,w,h){
    try{
      const imageData = ctx.getImageData(x,y,w,h);
      const data = imageData.data;
      const br = Number(brightness.value)/100;
      const co = Number(contrast.value)/100;
      const factor = (259 * (co*255 + 255)) / (255 * (259 - co*255));
      for(let p=0;p<data.length;p+=4){
        data[p] = truncate(factor*(truncate(data[p]*br)-128)+128);
        data[p+1] = truncate(factor*(truncate(data[p+1]*br)-128)+128);
        data[p+2] = truncate(factor*(truncate(data[p+2]*br)-128)+128);
      }
      ctx.putImageData(imageData,x,y);
    }catch(e){console.warn('pixel edit failed',e)}
  }

  function truncate(v){return Math.max(0,Math.min(255,Math.round(v)))}

  brightness.addEventListener('input', ()=> render());
  contrast.addEventListener('input', ()=> render());

  // stickers add
  stickersEl.addEventListener('click', (ev)=>{
    const s = ev.target.closest('.sticker'); if(!s) return;
    const type = s.dataset.src;
    addSticker(type);
  });

  function addSticker(type){
    const svgData = getStickerSVG(type);
    const imgEl = new Image();
    const svgBlob = new Blob([svgData], {type:'image/svg+xml;charset=utf-8'});
    const url = URL.createObjectURL(svgBlob);
    imgEl.onload = ()=>{
      const o = {type:'sticker', img:imgEl, x:20, y:20, w:120, h:120};
      overlays.push(o); render();
    }
    imgEl.src = url;
  }

  function getStickerSVG(type){
    if(type==='heart') return `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120'>‚ù§Ô∏è</text></svg>`;
    if(type==='sun') return `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120'>üåû</text></svg>`;
    if(type==='spark') return `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120'>‚ú®</text></svg>`;
    // default star
    return `<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='120'>‚≠ê</text></svg>`;
  }

  // add text
  document.getElementById('applyText').addEventListener('click', ()=>{
    const txt = document.getElementById('textInput').value.trim(); if(!txt) return;
    const o = {type:'text', text:txt, x:30, y:60, size:36, color:'#fff'}; overlays.push(o); render();
  });

  document.getElementById('clearOverlays').addEventListener('click', ()=>{overlays=[]; render()});

  // basic filters - implemented by pixel remapping
  document.getElementById('btnHDR').addEventListener('click', ()=>{applyHDR()});
  document.getElementById('btnCartoon').addEventListener('click', ()=>{applyCartoon()});
  document.getElementById('btnVintage').addEventListener('click', ()=>{applyVintage()});
  document.getElementById('btnBW').addEventListener('click', ()=>{applyBW()});

  function applyHDR(){if(!img) return; render(); const d = ctx.getImageData(0,0,canvas.width,canvas.height); for(let i=0;i<d.data.length;i+=4){ d.data[i] = truncate(Math.pow(d.data[i]/255,0.9)*255); d.data[i+1]=truncate(Math.pow(d.data[i+1]/255,0.9)*255); d.data[i+2]=truncate(Math.pow(d.data[i+2]/255,0.9)*255);} ctx.putImageData(d,0,0)}
  function applyCartoon(){ if(!img) return; render(); // posterize
    const d = ctx.getImageData(0,0,canvas.width,canvas.height); for(let i=0;i<d.data.length;i+=4){ d.data[i]=Math.floor(d.data[i]/32)*32; d.data[i+1]=Math.floor(d.data[i+1]/32)*32; d.data[i+2]=Math.floor(d.data[i+2]/32)*32; } ctx.putImageData(d,0,0) }
  function applyVintage(){ if(!img) return; render(); const d = ctx.getImageData(0,0,canvas.width,canvas.height); for(let i=0;i<d.data.length;i+=4){ const r=d.data[i], g=d.data[i+1], b=d.data[i+2]; d.data[i]=truncate((r*0.9 + g*0.6 + b*0.2)); d.data[i+1]=truncate((r*0.2 + g*0.8 + b*0.1)); d.data[i+2]=truncate((b*0.9)); } ctx.putImageData(d,0,0)}
  function applyBW(){ if(!img) return; render(); const d = ctx.getImageData(0,0,canvas.width,canvas.height); for(let i=0;i<d.data.length;i+=4){ const v = 0.3*d.data[i]+0.59*d.data[i+1]+0.11*d.data[i+2]; d.data[i]=d.data[i+1]=d.data[i+2]=v } ctx.putImageData(d,0,0)}

  // blurs (simple gaussian approximations)
  document.getElementById('btnPortraitBlur').addEventListener('click', ()=>{applyPortraitBlur()});
  document.getElementById('btnMotionBlur').addEventListener('click', ()=>{applyMotionBlur()});

  function applyPortraitBlur(){ if(!img) return; render(); // radial blur by drawing multiple scaled layers with opacity mask
    const tmp = document.createElement('canvas'); tmp.width=canvas.width; tmp.height=canvas.height; const tctx=tmp.getContext('2d'); tctx.drawImage(canvas,0,0); // simple: draw blurred layer and mask center
    // blur via scaling trick
    for(let s=1.02;s<=1.14;s+=0.02){ tctx.globalAlpha = 0.08; tctx.drawImage(tmp, - (tmp.width*(s-1))/2, - (tmp.height*(s-1))/2, tmp.width*s, tmp.height*s); }
    ctx.drawImage(tmp,0,0);
  }

  function applyMotionBlur(){ if(!img) return; render(); const d = ctx.getImageData(0,0,canvas.width,canvas.height); const w=canvas.width; const h=canvas.height; // simple horiz blur kernel
    const copy = new Uint8ClampedArray(d.data);
    const radius=6; for(let y=0;y<h;y++){ for(let x=0;x<w;x++){ let r=0,g=0,b=0, count=0; for(let k=-radius;k<=radius;k++){ const nx=x+k; if(nx<0||nx>=w) continue; const idx=(y*w+nx)*4; r+=copy[idx]; g+=copy[idx+1]; b+=copy[idx+2]; count++; } const idx=(y*w+x)*4; d.data[idx]=r/count; d.data[idx+1]=g/count; d.data[idx+2]=b/count; } } ctx.putImageData(d,0,0);
  }

  // improved background removal (non-AI heuristic)
  document.getElementById('btnRemove').addEventListener('click', async ()=>{ await improvedRemoveBG() });
  async function improvedRemoveBG(){ if(!img) return; render(); // strategy: compute background color by sampling borders, then make similar pixels transparent with feathering
    const fit = fitToCanvas(img.width, img.height, canvas.width, canvas.height);
    const imageData = ctx.getImageData(fit.x, fit.y, fit.w, fit.h);
    const d = imageData.data; const w=fit.w; const h=fit.h;
    // sample border pixels to build average bg color
    let samples = [];
    const sampleRect = 8; // sample thickness
    for(let x=0;x<w;x++){ for(let y=0;y<sampleRect;y++){ const i=(y*w+x)*4; samples.push([d[i],d[i+1],d[i+2]]); } for(let y=h-sampleRect;y<h;y++){ const i=(y*w+x)*4; samples.push([d[i],d[i+1],d[i+2]]); } }
    for(let y=0;y<h;y++){ for(let x=0;x<sampleRect;x++){ const i=(y*w+x)*4; samples.push([d[i],d[i+1],d[i+2]]); } for(let x=w-sampleRect;x<w;x++){ const i=(y*w+x)*4; samples.push([d[i],d[i+1],d[i+2]]); } }
    // average
    let br=0,bg=0,bb=0; samples.forEach(s=>{br+=s[0];bg+=s[1];bb+=s[2]}); br/=samples.length; bg/=samples.length; bb/=samples.length;
    // remove pixels close to bg color with tolerance and smooth alpha
    for(let y=0;y<h;y++){ for(let x=0;x<w;x++){ const idx=(y*w+x)*4; const r=d[idx], g=d[idx+1], b=d[idx+2]; const dist = Math.sqrt((r-br)*(r-br)+(g-bg)*(g-bg)+(b-bb)*(b-bb)); // larger dist = likely foreground
      const t = Math.max(0, Math.min(1, (dist-30)/120)); // map to [0..1]
      d[idx+3] = Math.round(255 * t);
    } }
    ctx.putImageData(imageData, fit.x, fit.y);
    // store as overlay (frame) to allow further edits
    // done
  }

  // enhance/upscale (very simple: draw at 2x then sharpen)
  document.getElementById('btnEnhance').addEventListener('click', async ()=>{ await enhance() });
  async function enhance(){ if(!img) return; render(); // upscale by 2x using intermediate canvas
    const tmp = document.createElement('canvas'); tmp.width=canvas.width*2; tmp.height=canvas.height*2; const tctx = tmp.getContext('2d'); tctx.imageSmoothingEnabled = true; tctx.drawImage(canvas,0,0,tmp.width,tmp.height);
    // mild sharpen
    const imgd = tctx.getImageData(0,0,tmp.width,tmp.height); const copy = new Uint8ClampedArray(imgd.data);
    const w=tmp.width, h=tmp.height; for(let y=1;y<h-1;y++){ for(let x=1;x<w-1;x++){ const idx=(y*w+x)*4; for(let c=0;c<3;c++){ const center = copy[idx+c]; const up = copy[idx - 4*w + c]; const down = copy[idx + 4*w + c]; const left = copy[idx - 4 + c]; const right = copy[idx + 4 + c]; const val = center*1.5 - 0.125*(up+down+left+right); imgd.data[idx+c] = truncate(val); } } }
    tctx.putImageData(imgd,0,0);
    // copy back to visible canvas with fit
    const final = document.createElement('canvas'); const ratio = Math.min(1000/tmp.width,700/tmp.height,1); final.width = Math.round(tmp.width*ratio); final.height = Math.round(tmp.height*ratio); final.getContext('2d').drawImage(tmp,0,0,final.width,final.height);
    canvas.width = final.width; canvas.height = final.height; ctx.drawImage(final,0,0);
  }

  // frames
  document.getElementById('btnFrame').addEventListener('click', ()=>{ overlays.push({type:'frame', color:'#ffffffaa', width:28, pad:12}); render(); });

  // download
  document.getElementById('btnDownload').addEventListener('click', ()=>{ const link = document.createElement('a'); link.download = 'nns_edit.png'; link.href = canvas.toDataURL('image/png'); link.click(); });

  // simple project save/load
  document.getElementById('saveProject').addEventListener('click', ()=>{
    if(!img) return alert('Upload an image first');
    const data = {img:canvas.toDataURL('image/png'), overlays, brightness:brightness.value, contrast:contrast.value};
    localStorage.setItem('nns-project', JSON.stringify(data)); alert('Project saved to localStorage');
  });
  document.getElementById('loadProject').addEventListener('click', ()=>{
    const raw = localStorage.getItem('nns-project'); if(!raw) return alert('No saved project');
    const data = JSON.parse(raw); const i = new Image(); i.onload = ()=>{ canvas.width = i.width; canvas.height = i.height; ctx.drawImage(i,0,0); img = i; overlays = data.overlays || []; brightness.value = data.brightness||100; contrast.value = data.contrast||100; render(); }; i.src = data.img;
  });

  // theme toggle (light/dark) local UI only
  document.getElementById('toggleTheme').addEventListener('click', ()=>{
    const body = document.body; if(body.style.background && body.style.background.includes('#0b1b2b')){ body.style.background = 'linear-gradient(180deg,#eaf6ff 0%,#cfeaff 100%)'; } else { body.style.background = 'linear-gradient(180deg,#071026 0%, #0b1b2b 100%)'; }
  });

  // utility: small loop to re-render during edits
  setInterval(()=>{ /* keep overlay text visible */ }, 1000);

  // initial render
  render();
</script>
</body>
</html>
